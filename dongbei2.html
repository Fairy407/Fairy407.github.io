<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>东北地区重要天气预报</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1a5f7a 0%, #2a9d8f 100%);
            color: white;
            padding: 20px 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .legend {
            padding: 15px 30px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
        }
        
        .gantt-container {
            padding: 20px;
            overflow-x: auto;
            position: relative;
        }
        
        .gantt-table {
            border-collapse: collapse;
            width: 100%;
            min-width: 1000px;
        }
        
        .gantt-table th, .gantt-table td {
            text-align: center;
            padding: 8px;
            font-size: 13px;
            height: 40px;
        }
        
        /* 时间行样式 */
        .gantt-table thead th {
            background-color: #f2f6fc;
            font-weight: 600;
            color: #555;
            position: sticky;
            top: 0;
            z-index: 10;
            border: 1px solid #ddd;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-left: none;
            border-right: none;
            position: relative;
        }
        
        /* 时间行第一个单元格保持正常位置 */
        .gantt-table thead th:first-child {
            border-left: 1px solid #ddd;
        }
        
        /* 时间行最后一个单元格保留边框 */
        .gantt-table thead th:last-child {
            border-right: 1px solid #ddd;
        }
        
        /* 关键修改：00时加粗 */
        .hour-00 .hour-label {
            font-weight: 700;
            color: #333;
        }
        
        .hour-00 .date-label {
            font-weight: 600;
            color: #333;
        }
        
        /* 机场行样式 - 保持完整边框 */
        .gantt-table tbody td {
            border: 1px solid #ddd;
        }
        
        /* 关键修改：机场行第一列 - 使用粘性定位和transform实现向左偏移 */
        .airport-name-cell {
            min-width: 120px;
            max-width: 120px;
            width: 120px;
            background-color: #f8f9fa;
            font-weight: 600;
            position: sticky;
            left: 0; /* 从0开始 */
            z-index: 5;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            /* 使用transform实现向左偏移 */
            transform: translateX(-25px);
        }
        
        /* 关键修改：为机场名称单元格添加额外宽度，确保滚动时完全显示 */
        .airport-name-cell::after {
            content: '';
            position: absolute;
            right: -25px;
            top: 0;
            bottom: 0;
            width: 25px;
            background-color: #f8f9fa;
            border-right: 1px solid #ddd;
        }
        
        /* 时间行第一列保持正常位置 */
        .airport-name-header {
            min-width: 120px;
            max-width: 120px;
            width: 120px;
            background-color: #f8f9fa;
            font-weight: 600;
            position: sticky;
            left: 0;
            z-index: 15;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
        }
        
        /* 时间列 - 固定宽度 */
        .time-header-cell, .time-cell {
            min-width: 50px;
            max-width: 50px;
            width: 50px;
            box-sizing: border-box;
        }
        
        /* 关键修改：将整个表体向右偏移半格 */
        .gantt-table tbody {
            position: relative;
            left: 25px; /* 向右偏移半格 */
        }
        
        /* 关键修改：时间行表格中线（下四分之一） */
        .time-header-cell::after {
            content: '';
            position: absolute;
            left: 50%; /* 从单元格中线开始 */
            bottom: 0;
            height: 12px; /* 高度的四分之一 */
            width: 1px;
            background-color: #ddd;
            z-index: 2;
            transform: translateX(-50%);
        }
        
        /* 关键修改：完全删除日期分隔线（包括23时和00时之间的所有线） */
        .day-separator::before,
        .day-separator::after {
            display: none !important;
        }
        
        /* 关键修改：只在日期标签下方显示细线表示日期分隔 */
        .day-separator {
            position: relative;
        }
        
        /* 在日期标签下方显示细线 */
        .day-separator .date-label {
            position: relative;
        }
        
        .day-separator .date-label::after {
            content: '';
            position: absolute;
            left: -10px;
            right: -10px;
            bottom: -2px;
            height: 1px;
            background-color: #999;
        }
        
        /* 机场行的日期分隔线 */
        .airport-day-separator {
            border-left: 2px solid #999 !important;
        }
        
        /* 机场行样式 */
        .airport-row {
            background-color: white;
            transition: background-color 0.2s;
        }
        
        .airport-row:hover {
            background-color: #f9f9f9;
        }
        
        .time-cell {
            height: 40px;
            position: relative;
            padding: 2px;
            overflow: visible !important;
        }
        
        /* 天气事件样式 */
        .weather-event {
            position: absolute;
            top: 2px;
            bottom: 2px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 500;
            overflow: hidden;
            white-space: nowrap;
            z-index: 2;
            cursor: default;
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;
            opacity: 0.85;
        }
        
        .weather-event:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            z-index: 3;
            opacity: 1;
        }
        
        /* 关键修改：事件条块从单元格最左侧开始 */
        .weather-event {
            left: 0;
            box-sizing: border-box;
        }
        
        /* 天气类型颜色 */
        .heavy-rain {
            background-color: rgba(46, 125, 50, 0.8); /* 深绿 - 中到大雨 */
            border: 1px solid rgba(46, 125, 50, 0.9);
        }
        
        .light-rain {
            background-color: rgba(102, 187, 106, 0.8); /* 浅绿 - 小到中雨 */
            border: 1px solid rgba(102, 187, 106, 0.9);
        }
        
        .strong-thunder-rain {
            background-color: rgba(211, 47, 47, 0.8); /* 正常红色 - 中到大雨伴CB/雷暴 */
            border: 1px solid rgba(211, 47, 47, 0.9);
        }
        
        .light-thunder-rain {
            background-color: rgba(244, 67, 54, 0.8); /* 浅红 - 小到中雨伴CB/雷暴 */
            border: 1px solid rgba(244, 67, 54, 0.9);
        }
        
        .strong-wind {
            background-color: rgba(141, 110, 99, 0.8); /* 棕色 - 大风 */
            border: 1px solid rgba(141, 110, 99, 0.9);
        }
        
        .time-header {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 2px;
            height: 100%;
        }
        
        .date-label {
            font-size: 10px;
            color: #777;
            margin-bottom: 2px;
        }
        
        .hour-label {
            font-weight: 600;
            font-size: 13px;
        }
        
        .footer {
            padding: 15px 30px;
            text-align: center;
            font-size: 12px;
            color: #777;
            border-top: 1px solid #eee;
            background-color: #f8f9fa;
        }
        
        .event-label {
            padding: 0 4px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .gantt-table th, .gantt-table td {
                padding: 6px 2px;
                font-size: 11px;
                height: 35px;
            }
            
            .time-header-cell, .time-cell {
                min-width: 40px;
                max-width: 40px;
                width: 40px;
            }
            
            .airport-name-header, .airport-name-cell {
                min-width: 100px;
                max-width: 100px;
                width: 100px;
            }
            
            /* 移动端调整偏移量 */
            .airport-name-cell {
                transform: translateX(-20px); /* 移动端半格偏移 (40px/2) */
            }
            
            .airport-name-cell::after {
                right: -20px;
                width: 20px;
            }
            
            .gantt-table tbody {
                left: 20px; /* 移动端半格偏移 (40px/2) */
            }
            
            .weather-event {
                font-size: 9px;
            }
            
            /* 移动端调整时间行中线高度 */
            .time-header-cell::after {
                height: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>东北地区重要天气预报</h1>
            <div class="subtitle">预报时段：2025年7月20日08时 - 7月21日12时 | 制作时间：2025年7月19日16时00分</div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color heavy-rain"></div>
                <span>中到大雨</span>
            </div>
            <div class="legend-item">
                <div class="legend-color light-rain"></div>
                <span>小到中雨</span>
            </div>
            <div class="legend-item">
                <div class="legend-color strong-thunder-rain"></div>
                <span>中到大雨伴CB/雷暴</span>
            </div>
            <div class="legend-item">
                <div class="legend-color light-thunder-rain"></div>
                <span>小到中雨伴CB/雷暴</span>
            </div>
            <div class="legend-item">
                <div class="legend-color strong-wind"></div>
                <span>大风</span>
            </div>
        </div>
        
        <div class="gantt-container">
            <table class="gantt-table">
                <thead id="time-header-row">
                    <!-- 时间表头由JavaScript生成 -->
                </thead>
                <tbody id="gantt-body">
                    <!-- 机场行由JavaScript生成 -->
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            注：颜色条块表示重要天气现象发生时段，空白表示无重要天气 | 基于MDRS重要天气发生概率通报表
        </div>
    </div>

    <script>
        // 更新后的机场天气数据
        const weatherData = [
            {
                airport: "哈尔滨太平机场",
                events: [
                    { 
                        type: "strong-wind", 
                        start: "2025-07-20T08:00", 
                        end: "2025-07-20T14:00", 
                        label: "大风",
                        description: "偏南风8-12米/秒，阵风15-19米/秒"
                    },
                    { 
                        type: "light-thunder-rain", 
                        start: "2025-07-20T14:00", 
                        end: "2025-07-20T17:00", 
                        label: "小到中雨伴CB",
                        description: "小到中雨伴CB"
                    }
                ]
            },
            {
                airport: "沈阳桃仙机场",
                events: [
                    { 
                        type: "heavy-rain", 
                        start: "2025-07-20T18:00", 
                        end: "2025-07-20T22:00", 
                        label: "中阵雨",
                        description: "中阵雨"
                    },
                    { 
                        type: "strong-thunder-rain", 
                        start: "2025-07-21T05:00", 
                        end: "2025-07-21T09:00", 
                        label: "中阵雨伴雷暴",
                        description: "中阵雨伴雷暴"
                    }
                ]
            },
            {
                airport: "大连周水子机场",
                events: [
                    { 
                        type: "light-rain", 
                        start: "2025-07-20T12:00", 
                        end: "2025-07-20T21:00", 
                        label: "小到中阵雨",
                        description: "小到中阵雨"
                    },
                    { 
                        type: "light-thunder-rain", 
                        start: "2025-07-20T21:00", 
                        end: "2025-07-21T02:00", 
                        label: "小到中阵雨伴雷暴",
                        description: "小到中阵雨伴雷暴"
                    }
                ]
            }
        ];

        // 生成时间表头 (7月20日08时 - 7月21日12时)
        function generateTimeHeaders() {
            const startDate = new Date("2025-07-20T08:00");
            const endDate = new Date("2025-07-21T12:00");
            const headerRow = document.getElementById("time-header-row");
            
            // 添加机场名称列
            const airportHeader = document.createElement("th");
            airportHeader.textContent = "机场";
            airportHeader.classList.add("airport-name-header");
            headerRow.appendChild(airportHeader);
            
            // 生成每小时列
            let currentTime = new Date(startDate);
            let lastDate = null;
            let hourIndex = 0;
            
            while (currentTime <= endDate) {
                const th = document.createElement("th");
                th.classList.add("time-header-cell");
                
                // 格式化时间显示
                const hour = currentTime.getHours();
                const date = currentTime.getDate();
                const month = currentTime.getMonth() + 1;
                const currentDateStr = `${month}-${date}`;
                
                // 检查是否是新的日期，添加分隔线
                if (lastDate !== currentDateStr && lastDate !== null) {
                    th.classList.add("day-separator");
                }
                lastDate = currentDateStr;
                
                // 如果是00时，添加特殊类
                if (hour === 0) {
                    th.classList.add("hour-00");
                }
                
                th.innerHTML = `
                    <div class="time-header">
                        <div class="date-label">${month}/${date}</div>
                        <div class="hour-label">${hour.toString().padStart(2, '0')}</div>
                    </div>
                `;
                
                // 设置数据属性以便后续计算
                th.dataset.hour = hour;
                th.dataset.date = currentDateStr;
                th.dataset.fullTime = currentTime.toISOString();
                th.dataset.hourIndex = hourIndex;
                
                headerRow.appendChild(th);
                
                // 增加1小时
                currentTime.setHours(currentTime.getHours() + 1);
                hourIndex++;
            }
        }

        // 生成机场行和天气事件
        function generateAirportRows() {
            const tbody = document.getElementById("gantt-body");
            const startDate = new Date("2025-07-20T08:00");
            const endDate = new Date("2025-07-21T12:00");
            
            weatherData.forEach(airportData => {
                const row = document.createElement("tr");
                row.classList.add("airport-row");
                
                // 机场名称单元格
                const airportCell = document.createElement("td");
                airportCell.textContent = airportData.airport;
                airportCell.classList.add("airport-name-cell");
                row.appendChild(airportCell);
                
                // 生成时间单元格
                let currentTime = new Date(startDate);
                let hourIndex = 0;
                let lastDateStr = null;
                
                while (currentTime <= endDate) {
                    const cell = document.createElement("td");
                    cell.classList.add("time-cell");
                    cell.dataset.hourIndex = hourIndex;
                    cell.dataset.time = currentTime.toISOString();
                    
                    // 检查是否是新的日期，为机场行添加分隔线
                    const date = currentTime.getDate();
                    const month = currentTime.getMonth() + 1;
                    const currentDateStr = `${month}-${date}`;
                    
                    if (lastDateStr !== currentDateStr && lastDateStr !== null) {
                        cell.classList.add("airport-day-separator");
                    }
                    lastDateStr = currentDateStr;
                    
                    row.appendChild(cell);
                    currentTime.setHours(currentTime.getHours() + 1);
                    hourIndex++;
                }
                
                tbody.appendChild(row);
            });
            
            // 在所有行创建后，再添加天气事件
            addWeatherEvents();
        }

        // 添加天气事件到表格
        function addWeatherEvents() {
            const startDate = new Date("2025-07-20T08:00");
            
            weatherData.forEach((airportData, airportIndex) => {
                const row = document.querySelectorAll('.airport-row')[airportIndex];
                
                airportData.events.forEach(event => {
                    const eventStart = new Date(event.start);
                    const eventEnd = new Date(event.end);
                    
                    // 计算事件开始和结束的小时索引
                    const startHourIndex = getHourDifference(startDate, eventStart);
                    const endHourIndex = getHourDifference(startDate, eventEnd);
                    
                    // 计算事件跨越的小时数
                    const durationHours = endHourIndex - startHourIndex;
                    
                    // 找到事件开始的单元格
                    const startCell = row.querySelector(`td[data-hour-index="${startHourIndex}"]`);
                    
                    if (startCell) {
                        const eventElement = document.createElement("div");
                        eventElement.classList.add("weather-event", event.type);
                        
                        // 获取当前单元格的实际宽度
                        const cellWidth = startCell.offsetWidth;
                        
                        // 计算事件宽度（跨越的小时数 * 单元格宽度）
                        const width = durationHours * cellWidth;
                        
                        // 事件条块从单元格最左侧开始
                        eventElement.style.width = `${width}px`;
                        eventElement.style.left = '0';
                        
                        // 添加事件标签
                        const labelSpan = document.createElement("span");
                        labelSpan.classList.add("event-label");
                        labelSpan.textContent = event.label;
                        eventElement.appendChild(labelSpan);
                        
                        // 设置标题提示
                        eventElement.title = `${airportData.airport}\n${event.description}\n时间: ${formatTime(eventStart)}-${formatTime(eventEnd)}`;
                        
                        startCell.appendChild(eventElement);
                    }
                });
            });
        }

        // 计算两个时间之间的小时差
        function getHourDifference(startTime, endTime) {
            return Math.round((endTime - startTime) / (1000 * 60 * 60));
        }

        // 格式化时间显示
        function formatTime(date) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            generateTimeHeaders();
            generateAirportRows();
        });

        // 监听窗口大小变化，重新计算事件条宽度
        window.addEventListener('resize', function() {
            // 重新添加天气事件以更新宽度
            setTimeout(() => {
                const existingEvents = document.querySelectorAll('.weather-event');
                existingEvents.forEach(event => event.remove());
                addWeatherEvents();
            }, 100);
        });
    </script>
</body>
</html>